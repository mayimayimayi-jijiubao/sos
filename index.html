<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>急救宝｜信息登记</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="./av-min.js"></script>
<script src="./qrcode.min.js"></script>

<style>
body {
  margin: 0;
  padding: 0;
  font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
  background: #fff;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  padding-top: 40px;
}
.container {
  width: 92%;
  max-width: 420px;
  text-align: center;
}

.logo {
  width: 140px;
  margin: 0 auto 16px;
}

h2 {
  font-size: 22px;
  font-weight: bold;
  color: #222;
  margin: 10px 0 20px;
}

label {
  display: block;
  text-align: left;
  color: #222;
  font-size: 14px;
  margin-bottom: 6px;
}

input {
  width: 100%;
  height: 44px;
  border-radius: 8px;
  border: 1px solid #ddd;
  padding: 0 12px;
  font-size: 16px;
  background: #fafafa;
  outline: none;
  transition: 0.2s;
  margin-bottom: 14px;
}
input:focus {
  border-color: #E60000;
  background: #fff;
}

button {
  width: 100%;
  height: 48px;
  background: #E60000;
  border: none;
  border-radius: 8px;
  font-size: 17px;
  color: #fff;
  font-weight: bold;
  margin-top: 8px;
  cursor: pointer;
}
button:active { opacity: 0.85; }

#qrcode {
  margin-top: 24px;
}
.tip {
  color: #777;
  font-size: 13px;
  margin-bottom: 14px;
}
</style>

<script>
AV.init({
  appId: "Ivzq5oxAhWX2BqNvdFKQbBjl-gzGzoHsz",
  appKey: "ESfT6VmHoUAzyc8Ay0ebZbuC",
  serverURL: "https://ivzq5oxa.lc-cn-n1-shared.com"
});

async function submitForm() {
  const phone = phoneInput.value.trim();
  const name = nameInput.value.trim();
  const emergencyName = emergencyNameInput.value.trim();
  const emergencyPhone = emergencyPhoneInput.value.trim();

  if(!phone || !name || !emergencyName || !emergencyPhone){
    alert('请填写所有必填项'); return;
  }

  try{
    const query = new AV.Query('UserInfo');
    query.equalTo('phone', phone);
    const existing = await query.first();
    let obj = existing ? existing : new (AV.Object.extend('UserInfo'))();
    obj.set('phone', phone);
    obj.set('name', name);
    obj.set('emergencyName', emergencyName);
    obj.set('emergencyPhone', emergencyPhone);
    await obj.save();

    alert('信息保存成功！');

    const url = window.location.origin + '/qrcode?phone=' + encodeURIComponent(phone);
    qrcodeArea.innerHTML = '';
    new QRCode(qrcodeArea, {text: url, width: 200, height: 200});
  }catch(err){
    alert('保存失败：' + err.message);
  }
}
</script>
</head>

<body>
<div class="container">
<img src="/logo.png" class="logo">
  <h2>我的急救信息</h2>

  <label>姓名 *</label>
  <input id="nameInput" placeholder="请输入姓名">

  <label>手机号 *</label>
  <input id="phoneInput" type="tel" placeholder="请输入手机号">

  <label>紧急联系人 *</label>
  <input id="emergencyNameInput" placeholder="请输入紧急联系人姓名">

  <label>联系人电话 *</label>
  <input id="emergencyPhoneInput" type="tel" placeholder="请输入联系人电话">

  <button onclick="submitForm()">生成急救二维码</button>

  <div id="qrcodeArea"></div>
</div>
</body>
</html>
